# OCR Comparison Tool

This tool compares the OCR outputs generated by `inference_all.py` with ground truth transcriptions from JSON files.

## Files

- `compare.py`: Main comparison script
- `config.yaml`: Configuration file with paths and settings
- `run_comparison.py`: Convenience script using the config file
- `test_config.py`: Script to validate your configuration
- `README.md`: This file

## Quick Start

1. **Test your configuration** (optional but recommended):
   ```bash
   cd /root/DNTextSpotter
   python comparetools/test_config.py
   ```

2. **Edit the configuration file** if needed:
   ```bash
   nano /root/DNTextSpotter/comparetools/config.yaml
   ```

3. **Run the comparison**:
   ```bash
   python comparetools/run_comparison.py
   ```

## Configuration File

Edit `config.yaml` to set your paths and preferences:

```yaml
# Base directories
input_base: "/mnt/d/minyeong/LTR/ltr_rotation_imgs"
output_base: "/mnt/d/minyeong/LTR/rotation_inference_results"

# Optional: specific folder to analyze (leave empty to process all folders)
folder: ""

# Confidence threshold for considering OCR detections (optional)
confidence_threshold: 0.3

# Output settings
verbose: true
save_detailed_report: false
report_file: "comparison_report.json"
```

## Usage Options

### Method 1: Using the convenience script (recommended)
```bash
cd /root/DNTextSpotter
python comparetools/run_comparison.py
```

### Method 2: Using the main script with config file
```bash
python comparetools/compare.py --config comparetools/config.yaml
```

### Method 3: Override config with command line arguments
```bash
# Override input/output paths
python comparetools/compare.py \
    --config comparetools/config.yaml \
    --input-base "/different/input/path" \
    --output-base "/different/output/path"

# Analyze specific folder only
python comparetools/compare.py \
    --config comparetools/config.yaml \
    --folder "specific_folder_name"
```

### Method 4: Old style (without config file)
```bash
python comparetools/compare.py \
    --input-base "/mnt/d/minyeong/LTR/ltr_rotation_imgs" \
    --output-base "/mnt/d/minyeong/LTR/rotation_inference_results"
```

## What it does

The tool:

1. **Reads ground truth**: Parses `spec_dict.json` files to extract expected numbers with units (kg, lbs, kPa, PSI)

2. **Reads OCR outputs**: Parses transcription files (`*_transcription.txt`) to extract detected text

3. **Extracts and compares numbers**: 
   - Looks for patterns like: `1450kg`, `3000lbs`, `575kpa`, `83psi`
   - Handles OCR errors like `ps1` (treated as `psi`)
   - Counts occurrences of each number

4. **Reports results**:
   - ✓ Correct matches (expected count = detected count)
   - ✗ Incorrect matches (counts don't match)
   - ! Extra detections (numbers found but not in ground truth)

## Expected Input Structure

```
/mnt/d/minyeong/LTR/ltr_rotation_imgs/
├── folder1/
│   ├── center_img.jpg
│   ├── left_img.jpg
│   ├── material_img.jpg
│   ├── right_img.jpg
│   └── spec_dict.json
├── folder2/
│   └── ...
```

## Expected Output Structure

```
/mnt/d/minyeong/LTR/rotation_inference_results/
├── folder1/
│   ├── center_img_transcription.txt
│   ├── left_img_transcription.txt
│   ├── material_img_transcription.txt
│   └── right_img_transcription.txt
├── folder2/
│   └── ...
```

## Example Output

```
=== Analyzing folder: folder1 ===
Ground truth numbers: {'1450kg': 1, '3195lbs': 1, '1360kg': 1, '3000lbs': 1, '575kpa': 2, '83psi': 2}

center_img_transcription.txt:
  Transcribed text: ['at', '3000lbs', 'at', '1450kg', '1360kg', '3195lbs']
  Detected numbers: ['3000lbs', '1450kg', '1360kg', '3195lbs']

right_img_transcription.txt:
  Transcribed text: ['cold', 'plies', '1nylon', 'plies', 'tread', '575kpa', '83psi', '83ps1', 'cold', '575kpa', 'sidewall']
  Detected numbers: ['575kpa', '83psi', '83psi', '575kpa']

Detected numbers (all files): {'3000lbs': 1, '1450kg': 1, '1360kg': 1, '3195lbs': 1, '575kpa': 2, '83psi': 2}

--- Comparison Results ---
✓ 1450kg: Expected 1, Found 1
✓ 3195lbs: Expected 1, Found 1
✓ 1360kg: Expected 1, Found 1
✓ 3000lbs: Expected 1, Found 1
✓ 575kpa: Expected 2, Found 2
✓ 83psi: Expected 2, Found 2
```

## Features

- Handles case-insensitive matching
- Normalizes OCR errors (e.g., `ps1` → `psi`)
- Counts multiple occurrences correctly
- Provides detailed per-file breakdown
- Shows overall accuracy statistics
